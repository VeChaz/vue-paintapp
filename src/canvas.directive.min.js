import{v4}from"uuid";import Pusher from"pusher-js";function inserted(el){const canvas=el,ctx=canvas.getContext("2d");canvas.width=1e3,canvas.height=800,ctx.lineJoin="round",ctx.lineCap="round",ctx.lineWidth=5;const pusher=new Pusher("2fb78f50662d40bd00bf",{cluster:"us2"}),channel=pusher.subscribe("painting");let prevPos={offsetX:0,offsetY:0},line=[],isPainting=!1;const userId=v4(),USER_STROKE="red",GUEST_STROKE="greenyellow";function handleMouseDown(e){const{offsetX:offsetX,offsetY:offsetY}=e;isPainting=!0,prevPos={offsetX:offsetX,offsetY:offsetY}}function endPaintEvent(){isPainting&&(isPainting=!1,sendPaintData())}function handleMouseMove(e){if(isPainting){const{offsetX:offsetX,offsetY:offsetY}=e,offSetData={offsetX:offsetX,offsetY:offsetY},positionInfo={start:{...prevPos},stop:{...offSetData}};line=line.concat(positionInfo),paint(prevPos,offSetData,"red")}}function sendPaintData(){const body={line:line,userId:userId};fetch("http://localhost:4000/paint",{method:"post",body:JSON.stringify(body),headers:{"content-type":"application/json"}}).then(()=>line=[])}function paint(prevPosition,currPosition,strokeStyle){const{offsetX:offsetX,offsetY:offsetY}=currPosition,{offsetX:x,offsetY:y}=prevPosition;ctx.beginPath(),ctx.strokeStyle=strokeStyle,ctx.moveTo(x,y),ctx.lineTo(offsetX,offsetY),ctx.stroke(),prevPos={offsetX:offsetX,offsetY:offsetY}}canvas.addEventListener("mousedown",handleMouseDown),canvas.addEventListener("mousemove",handleMouseMove),canvas.addEventListener("mouseup",endPaintEvent),canvas.addEventListener("mouseleave",endPaintEvent),channel.bind("draw",data=>{const{userId:id,line:line}=data;userId!==id&&line.forEach(position=>{paint(position.start,position.stop,GUEST_STROKE)})})}export default{inserted:inserted};